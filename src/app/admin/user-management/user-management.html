<div class="admin-layout">
  <!-- Navigation Header -->
  <header class="navbar">
    <div class="navbar-brand">
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
          <path d="M9 9h6v6H9z" fill="currentColor"/>
        </svg>
        <span>SecureBank</span>
      </div>
    </div>
    
    <nav class="navbar-nav">
      <a routerLink="/admin" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
        Home
      </a>
      <a routerLink="/admin/users" routerLinkActive="active" class="nav-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" fill="none"/>
          <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
        Admin Panel
      </a>
    </nav>
    
    <div class="navbar-user">
      <span class="welcome-text">Welcome, admin</span>
      <button class="logout-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke="currentColor" stroke-width="2" fill="none"/>
          <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2" fill="none"/>
          <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2"/>
        </svg>
        Logout
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="page-header">
      <div class="page-title">
        <h1>Admin Dashboard</h1>
        <p>Manage users and system settings</p>
      </div>
      <button class="add-user-btn" (click)="openAddModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" fill="none"/>
          <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
          <line x1="19" y1="8" x2="19" y2="14" stroke="currentColor" stroke-width="2"/>
          <line x1="22" y1="11" x2="16" y2="11" stroke="currentColor" stroke-width="2"/>
        </svg>
        Add User
      </button>
    </div>

    <div class="user-management-section">
      <div class="section-header">
        <div class="section-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" fill="none"/>
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </div>
        <div class="section-info">
          <h2>User Management</h2>
          <p>View and manage all registered users</p>
        </div>
      </div>

      <div class="users-table-container">
        <table class="users-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Role</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users; track user.id) {
              <tr [ngClass]="{'inactive-user': user.status === 'Inactive'}">
                <td class="username-cell">{{ user.username }}</td>
                <td class="email-cell">{{ user.email }}</td>
                <td class="phone-cell">{{ user.phone }}</td>
                <td class="role-cell">
                  <span [ngClass]="getRoleClass(user.role)" class="role-badge">{{ user.role }}</span>
                </td>
                <td class="status-cell">
                  <span [ngClass]="getStatusClass(user.status)" class="status-badge">{{ user.status }}</span>
                </td>
                <td class="actions-cell">
                  <button 
                    class="action-btn toggle-btn" 
                    (click)="toggleUserStatus(user)"
                    [title]="user.status === 'Active' ? 'Deactivate' : 'Activate'">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" fill="none"/>
                      <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    {{ user.status === 'Active' ? 'Deactivate' : 'Activate' }}
                  </button>
                  <button class="action-btn edit-btn" (click)="openEditModal(user)" title="Edit">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" fill="none"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                  </button>
                  <button class="action-btn delete-btn" (click)="openDeleteModal(user)" title="Delete">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2" fill="none"/>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>

<!-- Add User Modal -->
<div class="modal-overlay" [class.show]="showAddModal" (click)="closeAddModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add New User</h3>
      <p>Create a new user account</p>
      <button class="close-btn" (click)="closeAddModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>
    <form [formGroup]="userForm" (ngSubmit)="addUser()">
      <div class="form-row">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" formControlName="username" placeholder="Enter username">
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" formControlName="password" placeholder="••••••••">
        </div>
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" formControlName="email" placeholder="Enter email address">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="tel" id="phone" formControlName="phone" placeholder="Enter phone number">
        </div>
        <div class="form-group">
          <label for="role">Role</label>
          <select id="role" formControlName="role">
            <option value="User">User</option>
            <option value="Admin">Admin</option>
          </select>
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="!userForm.valid">Add User</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit User Modal -->
<div class="modal-overlay" [class.show]="showEditModal" (click)="closeEditModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Edit User</h3>
      <p>Update user information</p>
      <button class="close-btn" (click)="closeEditModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>
    <form [formGroup]="editForm" (ngSubmit)="updateUser()">
      <div class="form-row">
        <div class="form-group">
          <label for="edit-username">Username</label>
          <input type="text" id="edit-username" formControlName="username" placeholder="Enter username">
        </div>
        <div class="form-group">
          <label for="edit-password">Password (leave empty to keep current)</label>
          <input type="password" id="edit-password" formControlName="password" placeholder="••••••••">
        </div>
      </div>
      <div class="form-group">
        <label for="edit-email">Email</label>
        <input type="email" id="edit-email" formControlName="email" placeholder="Enter email address">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="edit-phone">Phone</label>
          <input type="tel" id="edit-phone" formControlName="phone" placeholder="Enter phone number">
        </div>
        <div class="form-group">
          <label for="edit-role">Role</label>
          <select id="edit-role" formControlName="role">
            <option value="User">User</option>
            <option value="Admin">Admin</option>
          </select>
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="!editForm.valid">Update User</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" [class.show]="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Delete User</h3>
      <p>Are you sure you want to delete this user?</p>
      <button class="close-btn" (click)="closeDeleteModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>
    <div class="delete-confirmation">
      <p><strong>{{ selectedUser?.username }}</strong> will be permanently deleted. This action cannot be undone.</p>
    </div>
    <div class="modal-actions">
      <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
      <button type="button" class="btn btn-danger" (click)="deleteUser()">Delete User</button>
    </div>
  </div>
</div>
